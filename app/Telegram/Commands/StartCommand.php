<?php

namespace App\Telegram\Commands;

use DateTime;
use App\Models\User;
use App\Services\TelegramService;
use Telegram\Bot\Commands\Command;
use Telegram\Bot\Laravel\Facades\Telegram;

class StartCommand extends Command
{
    protected string $name = 'start';
    protected string $description = 'Start Command to get you started';

    public function handle()
    {
        logger("start command");
        $updates = $this->getUpdate();
        $activation = $updates["message"]["text"];
        $new_user = $updates['message']['from'];
        $name = $new_user['first_name'] . " " . $new_user['last_name'];
        $id = $new_user["id"];


        try {
            $activation_key = explode(" ", $activation)[1];
            $user = User::where("uuid", $activation_key)->first();

            // Check if this telegram was used, if so REPLY
            if (User::where("telegram_id", $id)->exists()) {
                $this->replyWithMessage(['text' => "–•–º.. ü§î —ç—Ç–æ—Ç –∞–∫–∫–∞—É–Ω—Ç —É–∂–µ –±—ã–ª –∑–∞—Ä–µ–≥–µ—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ –≤ –ø—Ä–æ—Ñ–∏–ª—å —Ç—É—Ç üëâ https://misha.loca.lt/login"]);
                return;
            }

            // Check if user is already verified, if so REPLY
            if ($user->telegram_id !== null) {
                $this->replyWithMessage(['text' => "–í–∞—à –∞–∫–∫–∞—É–Ω—Ç —É–∂–µ –≤e—Ä–µ—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω. üòé –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å —Ç—É—Ç üëâ https://misha.loca.lt/dashboard"]);
                return;
            }
        } catch (\Exception $e) {
            // Check if user wasn't transferred, if so REPLY
            $this->replyWithMessage(['text' => "–•–æ—Ç–∏—Ç–µ –∑—Ä–µ–≥–µ—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ Start –ú–∞—Ä–∞—Ñ–æ–Ω? üòÉ –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ üëâ https://misha.loca.lt"]);
            return;
        }


        // try {
        //     // if chatMember ($_) wasn't found throw an error
        //     $_ = Telegram::getChatMember([
        //         'chat_id' => config("services.telegram.group_id"),
        //         'user_id' => $id,
        //     ]);
        //     $daysLeft = (new DateTime())->diff((new DateTime())->modify('last day of'))->days + 1;
        //     $user->days_left = $daysLeft;
        // } catch (\Exception $e) {
        //     // Handle exception if needed
        // }


        // update user
        $user->telegram_id = $new_user['id'];
        $user->telegram_username = $new_user['username'];
        $user->save();
        $this->replyWithMessage(['text' => "‚úÖ $name –ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –í—ã —É—á–∞—Å—Ç–Ω–∏–∫ –∫–ª—É–±–∞!

–°–ø–µ—Ä–≤–∞ —á–∏—Ç–∞–µ–º –≤—Å–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –∏ –¥–æ –∫–æ–Ω—Ü–∞! –ü–æ—Ç–æ–º –ø–µ—Ä–µ—á–∏—Ç—ã–≤–∞–µ–º –µ—â—ë —Ä–∞–∑ –∏ —Å–ª–µ–¥—É–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É!

–ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã —Å—Å—ã–ª–∫–∏ –Ω–∞ –∞—Ä—Ö–∏–≤–Ω—ã–µ –º–µ—Å—è—Ü–∞ –∫–ª—É–±–∞. –ú–µ—Å—è—Ü ¬´–ö–ª—É–± —Å—Ç–∞—Ä—Ç¬ª —Å–µ–π—á–∞—Å —Å–∞–º—ã–π –∞–∫—Ç—É–∞–ª—å–Ω—ã–π! –ü–æ–¥–ø–∏—à–∏—Ç–µ—Å—å —Å—Ä–∞–∑—É –Ω–∞ –Ω–µ–≥–æ ! –ò —Å–ª—É—à–∞–π—Ç–µ –≤—Å–µ –º–µ—Å—è—Ü–∞ –ø–æ –ø–æ—Ä—è–¥–∫—É.

–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –Ω–∏—Ö –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏! –¢–æ –µ—Å—Ç—å —ç—Ç–æ —Å–∞–º–∞—è –≤–∞–∂–Ω–∞—è –¥–ª—è –≤–∞—Å —Å–µ–π—á–∞—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è!

–ü–µ—Ä–≤—ã–π –º–µ—Å—è—Ü
t.me/joinchat/iSvEeQpRY5QzYzJi
(–Ω–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ) 

–í—Ç–æ—Ä–æ–π –º–µ—Å—è—Ü
t.me/joinchat/QSoelrVPzhgxOTIy

–¢—Ä–µ—Ç–∏–π –º–µ—Å—è—Ü
t.me/joinchat/KiHH4S2A2MMyYWZi

–ß–µ—Ç–≤—ë—Ä—Ç—ã–π –º–µ—Å—è—Ü
t.me/joinchat/eH9O3giE__g3NTRi

–ü—è—Ç—ã–π –º–µ—Å—è—Ü
t.me/+6SvcMQ-eU2UxYjJi

–î–µ–∫–∞–±—Ä—å 2021
t.me/+pd_DVCaBCEQzNzNi

–Ø–Ω–≤–∞—Ä—å 2022
t.me/+7NS5ZKL7UhQ0NDIy

–§–µ–≤—Ä–∞–ª—å 2022
t.me/+ZaYCRNW5oH8zYjQy

–ú–∞—Ä—Ç 2022
t.me/+-83yORuKzIY0NWYy

–ê–ø—Ä–µ–ª—å 2022
t.me/+Y8lVy6J3K6M4NTMy

–ú–∞–π 2022
t.me/+bD_9IfGxb-84ZWVi

–ò—é–Ω—å 2022
t.me/+nfX4dBlo8FwxMjUy

–ò—é–ª—å 2022
t.me/+J_Fx3DLDTYEzY2Ji

–ê–≤–≥—É—Å—Ç 2022
t.me/+xexjQKCVERU4MTEy

–°–µ–Ω—Ç—è–±—Ä—å 2022
t.me/+97FeUmVWwwo2ZTI6

–û–∫—Ç—è–±—Ä—å
t.me/+X1aMdiIY6S41YWVi

–ù–æ—è–±—Ä—å 
t.me/+ecRUOX8sn_U1MTli

–î–µ–∫–∞–±—Ä—å
t.me/+fOqkj8wbJQBmZmQy

–Ø–Ω–≤–∞—Ä—å 2023
t.me/+GjhMWJI2AGdhZWYy

–§–µ–≤—Ä–∞–ª—å 2023
t.me/+YZCeqH07KxY4MmRi

–ú–∞—Ä—Ç 2023
t.me/+ucaGfcj3NG5lYTUy

–ê–ø—Ä–µ–ª—å 2023
t.me/+af7cmW6fxPIwNDUy

–ú–∞–π 2023
t.me/+xWNcvRIZ6BdmNTky

–ò—é–Ω—å 2023
t.me/+dZh4ACD7RrhhYmMy

–ò—é–ª—å 2023
t.me/+hebZJtUGP1g5MmIy

–ö–ª—É–± –°—Ç–∞—Ä—Ç
t.me/+rY51umjdcC4wODMy
(–ù—É–∂–Ω–æ –ø–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É) 

–í–Ω–∏–º–∞–Ω–∏–µ! –ù–∞ –≤—Å–µ –∫–∞–Ω–∞–ª—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å—Ä–∞–∑—É –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è. –°–ª—É—à–∞–π—Ç–µ –ø–æ –ø–æ—Ä—è–¥–∫—É –≤—Å–µ –Ω–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ 2—Ö. –í—Å–µ –º–µ—Å—è—Ü–∞ –Ω—É–∂–Ω–æ –ø—Ä–æ—Å–ª—É—à–∞—Ç—å –∑–∞ 2-4 –¥–Ω—è! –≠—Ç–æ —Å–∞–º–æ–µ –≥–ª–∞–≤–Ω–æ–µ —Å–µ–π—á–∞—Å –∑–∞–¥–∞–Ω–∏–µ!

–í–∞–∂–Ω–æ! –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–µ–º—ã –≤ –∫–ª—É–±–µ –ø–æ—Ç–µ—Ä—è–ª–∏ —Å–≤–æ—é –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å. –ù–∞–ø—Ä–∏–º–µ—Ä, —á—Ç–æ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å 2 –∞–∫–∫–∞—É–Ω—Ç–∞. –£–∂–µ –Ω–µ –Ω—É–∂–Ω–æ! –¢–æ –µ—Å—Ç—å.. —Ç–æ —á—Ç–æ –≤—ã –∏–∑—É—á–∞–ª–∏ –Ω–∞ –º–∞—Ä–∞—Ñ–æ–Ω–µ, –±—ã–ª–∞ —Å–∞–º–∞—è –Ω–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è. –ù–æ –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —ç—Ç–æ, –≤—Å–µ —Ä–∞–≤–Ω–æ –≤—Å–µ –º–µ—Å—è—Ü–∞ –Ω—É–∂–Ω–æ –ø—Ä–æ—Å–ª—É—à–∞—Ç—å –Ω–∞ 2—Ö !

–û–≥—Ä–æ–º–Ω–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –≤—Å–µ –ø—Ä–æ—Å–ª—É—à–∞—Ç—å –∑–∞–ª–ø–æ–º –∑–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –±—ã—Å—Ç—Ä–æ–µ –≤—Ä–µ–º—è! –ß—Ç–æ–±—ã –Ω–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –Ω–∞–≤–∞–ª–∏–ª–∞—Å—å –Ω–∞ –≤–∞—Å –∫–∞–∫ —Å–Ω–µ–∂–Ω—ã–π –∫–æ–º. –í—Å—é –Ω–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∫–ª—É–±–µ —Å–ª—É—à–∞–π—Ç–µ —Å—Ä–∞–∑—É! –ß—Ç–æ–±—ã –≤–∞–º —Å–µ–π—á–∞—Å —Å–¥–µ–ª–∞—Ç—å –º–Ω–æ–≥–æ –ø—Ä–æ–¥–∞–∂ –ø–æ–∫–∞ —Å–µ–∑–æ–Ω!

–ë–æ—Ç –¥–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤: @poshagamshop_bot

–í–∏–¥–µ–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∞ - youtube.com/watch?v=jd1qkLb99Sw&si=EnSIkaIECMiOmarE

–ü–æ–º–æ—â–Ω–∏–∫ –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–∫–∞–∑—ã –ø–æ –¥—Ä–æ–ø–ø—É –°–µ—Ä–≥–µ–π. 

–ï–≥–æ –¢–µ–ª–µ–≥—Ä–∞–º: @poshagam_info
–ü–∏—Å–∞—Ç—å —Å—Ç—Ä–æ–≥–æ –Ω–∞ —ç—Ç–æ—Ç –∞–∫–∫–∞—É–Ω—Ç‚¨ÜÔ∏è

–ó–∞–∫–∞–∑—ã –≤—Å–µ –º–æ–∂–µ—Ç–µ —Ç–∞–∫–∂–µ –ø—Ä–∏—Å—ã–ª–∞—Ç—å –µ–º—É –∏–ª–∏ —á–µ—Ä–µ–∑ –±–æ—Ç.

–ö–∞–∂–¥—ã–π –ø–æ—Ç–æ–∫ –º–∞—Ä–∞—Ñ–æ–Ω–∞ –¥–µ–π—Å—Ç–≤—É–µ—Ç –ø—Ä–∞–≤–∏–ª–æ! 1 —É—á–∞—Å—Ç–Ω–∏–∫ –Ω–∞ 1 –≥–æ—Ä–æ–¥. –í —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ç–æ–∫–µ –≤–æ–∑–º–æ–∂–Ω–æ –±—É–¥–µ—Ç –Ω–æ–≤—ã–π –ø–∞—Ä—Ç–Ω—ë—Ä! –ü–æ—ç—Ç–æ–º—É —É –≤–∞—Å –µ—Å—Ç—å —Ü–µ–ª—ã–π –º–µ—Å—è—Ü –Ω–∞ —Ç–æ, —á—Ç–æ–±—ã —Ä–∞—Å–∫–∞—á–∞—Ç—å —Å–≤–æ–π –º–∞–≥–∞–∑–∏–Ω –∏ —Å—Ç–∞—Ç—å –Ω–æ–º–µ—Ä–æ–º 1 –≤ —Å–≤–æ—ë–º –≥–æ—Ä–æ–¥–µ! –ù–∞–ø–æ–º–∏–Ω–∞—é —á—Ç–æ –Ω–∏–∫—Ç–æ –≤–∞–º –Ω–µ –∑–∞–ø—Ä–µ—â–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∏ –ø–æ –¥—Ä—É–≥–∏–º –≥–æ—Ä–æ–¥–∞–º —Ç–æ–∂–µ! 

–í–Ω–∏–º–∞–Ω–∏–µ! –í–æ—Ç –º–æ–π –ª–∏—á–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç –¥–ª—è —Å–≤—è–∑–∏: @akprivatee –°–æ–æ–±—â–µ–Ω–∏–µ –º–Ω–µ –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –ø—Ä–æ—Å–ª—É—à–∞–µ—Ç–µ –≤—Å–µ –º–µ—Å—è—Ü–∞ –≤ –¢–µ–ª–µ–≥—Ä–∞–º! –¢–∞–∫–∂–µ –ø–æ –∑–∞–¥–∞–Ω–∏—è–º –ø–∏—Å–∞—Ç—å —É–∂–µ –Ω–µ –Ω—É–∂–Ω–æ! –û–Ω–∏ —É–∂–µ –Ω–µ –∞–∫—Ç—É–∞–ª—å–Ω—ã!

–ü–∏—Å–∞—Ç—å —Å–ª–æ–≤–∞ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏ —Ç–æ–∂–µ –Ω–µ –Ω—É–∂–Ω–æ! –≠—Ç–æ –æ—Ç–≤–ª–µ–∫–∞–µ—Ç –º–µ–Ω—è –æ—Ç —Ä–∞–±–æ—Ç—ã! –ü—Ä–æ—à—É –æ—Ç–Ω–µ—Å—Ç–∏—Å—å —Å –ø–æ–Ω–∏–º–∞–µ–º!

–ù–µ–ª—å–∑—è –Ω–∏–∫–æ–º—É –ø–∏—Å–∞—Ç—å –∏–∑ –∫–ª—É–±–∞ –∏ –æ—Ç–≤–ª–µ–∫–∞—Ç—å –æ—Ç —Ä–∞–±–æ—Ç—ã!

–í–æ–∑–≤—Ä–∞—Ç –∑–∞ –∫–ª—É–± –º—ã –Ω–µ –¥–µ–ª–∞–µ–º! –£—Å–ª—É–≥–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ–∫–∞–∑–∞–Ω–Ω–æ–π, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –≤–∞–º –≤—ã—Å–ª–∞–ª–∏ –¥–æ—Å—Ç—É–ø!

–ó–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª –≤—ã –º–æ–∂–µ—Ç–µ –±—ã—Ç—å –∏—Å–∫–ª—é—á–µ–Ω—ã –∏–∑ –∫–ª—É–±–∞!

–ü—Ä–∏—Å—Ç—É–ø–∞–π—Ç–µ –∫ —Ä–∞–±–æ—Ç–µ —Å—Ä–∞–∑—É –∏ –Ω–µ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–π—Ç–µ! –†–∞–∑–≤–∏—Ç–∏—è –≤–∞–º! )) üòâ
        "]);
        $this->replyWithMessage(['text' => "–î–æ—Å—Ç—É–ø –≤ –∫–ª—É–± START ‚úÖ - https://t.me/+U86N3fnqA7wzM2Vl"]);
    }
}
